<!DOCTYPE html>
<html>
	<head lang="ru">
		<title>Whitesquare</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<link href="../public/bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"> 
		
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
		<![endif]-->
		
	</head>
	<body>
		<div class="container">
			<header>
				<a href="/"><img src="" alt="Whitesquare logo"></a>
			</header>
			<nav class="navbar navbar-default">
				<div class="container-fluid">
					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="navbar-header">
					  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					  </button>
					  <a class="navbar-brand" href="#">Brand</a>
					</div>
					
					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
						<ul class="nav navbar-nav">
							<li class="active"><a href="C:\wamp64\www\stat.admin\client\index.html">Главная</a></li>
							<li><a href="/news/">Новости</a></li>
							<li><a href="C:\wamp64\www\stat.admin\client\expensetypelist.html">Общая статистика</a></li>
							<li><a href="/about/">О проекте</a></li>			
							<li><a href="/help/">Обращение в службу поддержки</a></li>
						</ul>
						<ul class="nav navbar-nav navbar-right">
							<li><button type="button" class="btn btn-default navbar-btn" data-toggle="modal" data-target="#logonModal">Вход</button></li>
							<li><button type="button" class="btn btn-default navbar-btn" data-toggle="modal" data-target="#registerModal">Регистрация</button></li>
						</ul>
					</div><!-- /.navbar-collapse -->
				</div><!-- /.container-fluid -->
			</nav>
			<div class="heading"></div>
			<div class="row"><div class="col-lg-12"><div>&nbsp;</div></div></div>
			<div class="row"><div class="col-lg-12"><div>&nbsp;</div></div></div>
			<div class="row"><div class="col-lg-12"><div>&nbsp;</div></div></div>
			<div class="row"><div class="col-lg-12"><div>&nbsp;</div></div></div>
			<div class="row"><div class="col-lg-12"><div>&nbsp;</div></div></div>
			
			<div class="row">
				<div class="col-lg-12">
					<form class="form-horizontal">
						<div class="form-group">
							<label for="region" class="col-lg-3 control-label">Выберите регион/область</label>
							<div class="col-lg-8">
								<select name="region" id="region" class="form-control">
									<option value="*" selected="selected"></option>
									<option value="1">Московская область</option>
									<option value="2">Волгоградская область</option>
								<select>
								<!--<input type="region" class="form-control" id="inputRegion" placeholder="Регион">-->
							</div>
						</div>
						<div class="form-group">
							<label for="city" class="col-lg-3 control-label">Выберите город</label>
							<div class="col-lg-8">
								<select name="city" id="city" class="form-control">
									<option value="*" selected="selected"></option>
									<option value="1">Москва</option>
									<option value="2">Волгоград</option>
								<select>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<button type="submit" class="btn btn-default">Перейти</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<footer>
			footer
		</footer>
		<!-- Модальные окна -->
		<div class="modal fade" id="logonModal" tabindex="-1" role="dialog" aria-labelledby="logonModalHeader">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="logonModalHeader">Добро пожаловать</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-lg-1"></div>
							<div class="col-lg-offset-1 col-lg-10 center-block">
								<form class="form-signin">
									<h2 class="form-signin-heading text-center">Авторизация</h2>
									<div class="input-group">
										<span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
										<input type="email" id="email" class="form-control" placeholder="Email" autofocus="">
									</div>
									<div class="row"><div class="col-lg-12 text-center">ИЛИ</div></div>
									<div class="input-group">
											<span class="input-group-addon"><i class="glyphicon glyphicon-phone-alt"></i></span>
											<input id="phone" type="tel" class="form-control" name="phone" value="" placeholder="Телефон" pattern="[0-9]+" maxlength="12">                                        
									</div>
									<div class="row"><div class="col-lg-12 text-center">&nbsp;</div></div>
									<div class="input-group">
										<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
										<input id="password" type="password" class="form-control" name="password" value="" required="" placeholder="Пароль">                                        
									</div>
									<div class="checkbox">
										<label>
											<input type="checkbox" value="remember-me"> Запомнить меня
										</label>
									</div>
									<!--<button class="btn btn-lg btn-primary btn-block" type="submit" formmethod="get" formaction="/session/start">Войти</button>-->
									<button class="btn btn-lg btn-primary btn-block" onclick="login();">Войти</button>
								</form>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<!--<button type="button" class="btn btn-default" data-dismiss="modal">Отмена</button>-->
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="registerModalHeader">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="registerModalHeader">Добро пожаловать</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-lg-1"></div>
							<div class="col-lg-offset-1 col-lg-10 center-block">
								<!-- wizard: http://vadimg.com/twitter-bootstrap-wizard-example/#examples -->
								<form class="form-signin">
									<h2 class="form-signin-heading text-center">Регистрация</h2>
									<div class="input-group">
										<span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
										<input type="email" id="email" class="form-control" placeholder="Email" autofocus="">
									</div>
									<div class="row"><div class="col-lg-12 text-center">И/ИЛИ</div></div>
									<div class="input-group">
											<span class="input-group-addon"><i class="glyphicon glyphicon-phone-alt"></i></span>
											<input id="phone" type="tel" class="form-control" name="phone" value="" placeholder="Телефон" pattern="[0-9]+" maxlength="12">                                        
									</div>
									<div class="row"><div class="col-lg-12 text-center">&nbsp;</div></div>
									<div class="input-group">
										<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
										<input id="password" type="password" class="form-control" name="password" value="" required="" placeholder="Пароль">                                        
									</div>
									<div class="row"><div class="col-lg-12 text-center">&nbsp;</div></div>
									<div class="input-group">
										<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
										<input id="password2" type="password" class="form-control" name="password2" value="" required="" placeholder="Повторите пароль">                                        
									</div>
									<div class="row"><div class="col-lg-12 text-center">&nbsp;</div></div>
									<!--<button class="btn btn-lg btn-primary btn-block" type="submit" formmethod="get" formaction="/session/start">Войти</button>-->
									<button class="btn btn-lg btn-primary btn-block" onclick="register();">Зарегистрироваться</button>
								</form>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<!--<button type="button" class="btn btn-default" data-dismiss="modal">Отмена</button>-->
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
		<script src="../public/bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>
		<script src="../public/jsrender.js"></script>
		<!--<script src="../public/sha1.js"></script>-->
		<!-- https://www.npmjs.com/package/js-sha1 -->
		<script src="../public/js-sha1-0.3.0.js"></script>
		
		<script type="text/javascript"><!--
			function login() {
				var url = '/session/start';
				var modal = $("#logonModal");
				
				var phone = modal.find('#phone').val();
				if (phone) url += '&phone=' + encodeURIComponent(phone);
				var email = modal.find('#email').val();
				if (email) url += '&email=' + encodeURIComponent(email);
				var password = modal.find('#password').val();
				password = sha1(password);
				if (password) url += '&password=' + encodeURIComponent(password);
				
				console.log(url);
				
				$.ajax({
					url: url,
					dataType: 'json',
					method: 'post',
					beforeSend: function() {
							// показываем прогрессбар
					},
					complete: function() {
						// скрываем прогрессбар
					},			
					success: function(json) {
						if(json.ok){
							if(json.redirect) document.location = json.redirect;
							else document.location.reload();
						}
						else {
							console.log("Login failed");
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						//console.log(thrownError + "\r\n" + (xhr != null ? xhr.statusText + "\r\n" + xhr.responseText + "\r\n" : ""));
						console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						//console.log(thrownError);
						//alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					}
				});
			}
			
			function register() {
			}
		//--></script>
	</body>
</html>